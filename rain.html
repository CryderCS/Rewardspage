<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>CryderCS Rain.gg Leaderboard</title>
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>
    <nav>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/csgoroll.html" >Csgoroll Leaderboard</a></li>
            <li><a href="/rewards.html">Rewards</a></li>
        </ul>
    </nav>
    <h1>Willkommen auf meiner Website</h1>
    <p>Wählen Sie einen Menüeintrag, um mehr zu erfahren.</p>
    <div id="table-container"></div> <!-- Hier wird die Tabelle angezeigt -->

    <h1>Renntabelle</h1>
    <div id="table-container"></div> <!-- Hier wird die Tabelle angezeigt -->

    <script>
        const funcall = async () => {
            const url = 'https://api.rain.gg/v1/affiliates/races?participant_count=50';
            const headers = {
                'accept': 'application/json',
                'x-api-key': 'a74cf8c9-e7f8-4880-88e0-24553139e786' // Ersetzen Sie dies durch Ihren tatsächlichen API-Schlüssel
            };
            var options = {
                'method': 'get',
                'headers': headers
            };

            try {
                const response = await fetch(url, options);
                const jsonResponse = await response.json();

                if (jsonResponse.results && Array.isArray(jsonResponse.results) && jsonResponse.results.length > 0) {
                    const participantsData = [];

                    jsonResponse.results.forEach(race => {
                        if (race.participants && Array.isArray(race.participants) && race.participants.length > 0) {
                            race.participants.forEach(participant => {
                                participantsData.push([
                                    race.id,
                                    race.name,
                                    participant.username,
                                    participant.position,
                                    participant.experience,
                                    participant.prize,
                                    participant.wagered
                                ]);
                            });
                        } else {
                            participantsData.push([race.id, race.name, "Keine Teilnehmer gefunden"]);
                        }
                    });

                    generateTable(participantsData);
                } else {
                    generateTable([["Keine Renndaten gefunden"]]);
                }
            } catch (error) {
                console.error("Fehler beim Abrufen der Daten:", error);
                generateTable([["Fehler beim Abrufen der Daten"]]);
            }

            function generateTable(data) {
                const container = document.getElementById('table-container');
                container.innerHTML = ''; // Vorherigen Inhalt löschen

                const table = document.createElement('table');
                table.style.width = '100%';
                table.setAttribute('border', '1');

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                const headers = ['Renn-ID', 'Rennname', 'Benutzername', 'Position', 'Erfahrung', 'Preis', 'Eingesetzter Betrag'];
                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                data.forEach(rowData => {
                    const row = document.createElement('tr');
                    rowData.forEach(cellData => {
                        const td = document.createElement('td');
                        td.textContent = cellData;
                        row.appendChild(td);
                    });
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);

                container.appendChild(table);
            }
        };

        // Funktion wird beim Laden der Seite aufgerufen
        window.onload = funcall;
    </script>
    <table id="table-container"></table>
</body>
</html>
